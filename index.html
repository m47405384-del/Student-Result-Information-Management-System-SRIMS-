<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Student Result Information Management System (SRIMS)</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:Roboto, sans-serif}
    body{background:linear-gradient(135deg,#cce0ff,#fff);min-height:100vh;padding:32px;display:flex;justify-content:center}
    .container{width:100%;max-width:1100px}
    .card{background:#fff;border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,24,71,0.06);margin-bottom:16px}
    .top{display:flex;gap:20px;align-items:flex-start;margin-bottom:18px}
    .brand{flex:1}
    .school{width:360px;padding:14px;border-radius:10px;background:linear-gradient(90deg,rgba(51,153,255,0.06),rgba(0,115,230,0.03));color:#0b4f86}
    .center-box{width:420px;margin:0 auto}
    h1,h2,h3{color:#074a8a;margin-bottom:8px}
    .small{font-size:13px;color:#556677}
    .muted{color:#7b8a9a}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    label{font-size:13px;color:#556677;margin-bottom:6px;display:block}
    input,select,textarea{width:100%;padding:10px;border:1px solid #d0e8ff;border-radius:8px;font-size:14px}
    .btn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,#2f8fff,#0066cc);color:#fff;font-weight:600;cursor:pointer}
    .btn-ghost{background:none;border:1px solid #2f8fff;color:#2f8fff;padding:8px 12px;border-radius:10px;cursor:pointer}
    .link-btn{background:none;border:none;color:#0a66d6;text-decoration:underline;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #d7eaff;padding:10px;text-align:center;font-size:14px}
    th{background:#2f8fff;color:#fff}
    .flex-between{display:flex;justify-content:space-between;align-items:center}
    .hidden{display:none}
    .info-box{background:#f7fbff;padding:12px;border-radius:10px;border:1px solid #dceeff;margin-bottom:10px}
    @media (max-width:980px){.top{flex-direction:column}.school{width:100%}.center-box{width:100%}}
  </style>
</head>
<body>
  <div class="container">
    <div class="top">
      <div class="brand card">
        <div class="center-box">
          <h1>Student Result Information Management System (SRIMS)</h1>
          <div class="small muted">Login to manage and view student results for the academic session.</div>
        </div>
      </div>
      <div class="school card" id="schoolInfoBox">
        <div style="font-weight:700;font-size:18px">Pakistan International School Al Khobar</div>
        <div class="small">P.O. Box 1439, Al-Khobar 31952, Saudi Arabia</div>
      </div>
    </div>

    <!-- AUTH -->
    <div id="authArea" class="card">
      <div id="loginBox" class="center-box">
        <h2>Login</h2>
        <input id="loginUser" type="text" placeholder="Username">
        <input id="loginPass" type="password" placeholder="Password" style="margin-top:8px">
        <div style="margin-top:12px"><button class="btn" onclick="login()">Login</button></div>
        <div style="margin-top:10px;text-align:center"><button class="link-btn" onclick="showRegister()">Register new user</button></div>
      </div>

      <div id="registerBox" class="center-box hidden" style="margin-top:12px">
        <h2>Register</h2>
        <input id="regUser" type="text" placeholder="Choose username">
        <input id="regPass" type="password" placeholder="Choose password" style="margin-top:8px">
        <div style="margin-top:12px"><button class="btn" onclick="register()">Create account</button></div>
        <div style="margin-top:8px;text-align:center"><button class="link-btn" onclick="cancelRegister()">Back to login</button></div>
      </div>
    </div>

    <!-- MENU -->
    <div id="menu" class="card hidden">
      <h2>Main Menu</h2>
      <div id="menuButtons" style="display:flex;gap:12px;justify-content:center;padding:8px 0 40px 0;position:relative">
        <button class="btn" onclick="showCalc()">Calculate Grade</button>
        <button class="btn" onclick="showCheck()">Check Grade</button>
        <button id="logoutBtn" onclick="logout()" style="position:absolute;left:12px;bottom:0;background:#ff4d4d;padding:8px 12px;border-radius:10px;color:#fff;border:none;cursor:pointer">Logout</button>
      </div>
    </div>

    <!-- CALCULATE & SAVE -->
    <div id="calc" class="card hidden">
      <div style="margin-bottom:8px"><strong>School:</strong> Pakistan International School Al Khobar</div>
      <h3>Student Result Card</h3>

      <div class="row" style="margin-top:8px">
        <div style="flex:1"><label>Admission No</label><input id="admission" type="text" placeholder="Admission number" oninput="lookupByAdmission()"></div>
        <div style="flex:1"><label>Roll No</label><input id="sroll" type="text" placeholder="Roll number" oninput="lookupByRoll()"></div>
        <div style="flex:1"><label>Class / Section</label><input id="sclass" type="text" placeholder="Class / Section"></div>
      </div>

      <div class="row" style="margin-top:8px">
        <div style="flex:1"><label>Student Name</label><input id="sname" type="text" placeholder="Student full name"></div>
        <div style="flex:1"><label>Father's Name</label><input id="fatherName" type="text" placeholder="Father's full name"></div>
        <div style="flex:1"><label>Session</label><input id="session" type="text" value="2025-2026"></div>
      </div>

      <h3 style="margin-top:12px">Enter Marks</h3>

      <div class="row">
        <div style="flex:1"><label>Chemistry (Max: <span id="chemMax">75</span>)</label><input id="chem" type="text" placeholder="Chemistry marks"></div>
        <div style="flex:1"><label>Computer / Biology (Max: <span id="compMax">75</span>)</label><input id="compbio" type="text" placeholder="Computer/Biology marks"></div>
        <div style="flex:1"><label>Physics (Max: <span id="physMax">75</span>)</label><input id="phys" type="text" placeholder="Physics marks"></div>
      </div>

      <div class="row" style="margin-top:8px">
        <div style="flex:1"><label>Mathematics (Max: <span id="mathMax">75</span>)</label><input id="math" type="text" placeholder="Mathematics marks"></div>
        <div style="flex:1"><label>English (Max: <span id="engMax">75</span>)</label><input id="eng" type="text" placeholder="English marks"></div>
        <div style="flex:1"><label>Urdu (Max: <span id="urduMax">75</span>)</label><input id="urdu" type="text" placeholder="Urdu marks"></div>
      </div>

      <div class="row" style="margin-top:8px">
        <div style="flex:1"><label>Islamiyat (Max: <span id="islMax">100</span>)</label><input id="isl" type="text" placeholder="Islamiyat marks"></div>
        <div style="flex:1"><label>Tarjuma-tul-Quran (Max: <span id="tarMax">50</span>)</label><input id="tar" type="text" placeholder="Tarjuma marks"></div>
        <div style="flex:1"><label>Pakistan Studies (Max: <span id="pakMax">50</span>)</label><input id="pak" type="text" placeholder="Pakistan Studies marks"></div>
      </div>

      <div class="flex-between" style="margin-top:12px">
        <div style="flex:1;margin-right:8px"><button class="btn" onclick="generateAndSave()">Generate & Save</button></div>
        <div style="flex:1;margin-left:8px"><button class="btn-ghost" onclick="backFromCalc()">Back to Menu</button></div>
      </div>

      <div id="resultArea" class="hidden">
        <div id="summaryArea" class="summary" style="margin-top:12px;text-align:left">
          <div id="nameOut">Name: -</div>
          <div id="classOut">Class: -</div>
          <div id="rollOut">Roll No: -</div>
          <div id="admOut">Admission No: -</div>
          <div id="fatherOut">Father: -</div>
          <div id="totalOut">Total Marks: 0 / 650</div>
          <div id="percOut">Percentage: 0%</div>
          <div id="gradeOut">Grade: -</div>
          <div id="remOut">Remarks: -</div>
        </div>

        <table>
          <thead><tr><th>Subject</th><th>Obtained</th><th>Total</th><th>%</th><th>Grade</th><th>Remarks</th></tr></thead>
          <tbody>
            <tr><td>Chemistry</td><td id="rchem">0</td><td id="mchem">75</td><td id="pchem">0%</td><td id="gchem">-</td><td id="rcem">-</td></tr>
            <tr><td>Computer/Biology</td><td id="rcomp">0</td><td id="mcomp">75</td><td id="pcomp">0%</td><td id="gcomp">-</td><td id="rcompm">-</td></tr>
            <tr><td>Physics</td><td id="rphys">0</td><td id="mphys">75</td><td id="pphys">0%</td><td id="gphys">-</td><td id="rphysm">-</td></tr>
            <tr><td>Mathematics</td><td id="rmath">0</td><td id="mmath">75</td><td id="pmath">0%</td><td id="gmath">-</td><td id="rmathm">-</td></tr>
            <tr><td>English</td><td id="reng">0</td><td id="meng">75</td><td id="peng">0%</td><td id="geng">-</td><td id="rengm">-</td></tr>
            <tr><td>Urdu</td><td id="rurdu">0</td><td id="murdu">75</td><td id="purdu">0%</td><td id="gurdu">-</td><td id="rurdum">-</td></tr>
            <tr><td>Islamiyat</td><td id="risl">0</td><td id="misl">100</td><td id="pisl">0%</td><td id="gisl">-</td><td id="rislm">-</td></tr>
            <tr><td>Tarjuma-tul-Quran</td><td id="rtar">0</td><td id="mtar">50</td><td id="ptar">0%</td><td id="gtar">-</td><td id="rtarm">-</td></tr>
            <tr><td>Pakistan Studies</td><td id="rpak">0</td><td id="mpak">50</td><td id="ppak">0%</td><td id="gpak">-</td><td id="rpakm">-</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- CHECK -->
    <div id="check" class="card hidden">
      <h3>Check Result (Admin / Student)</h3>
      <div class="row">
        <div style="flex:1"><label>Admission No</label><input id="checkAdm" type="text" placeholder="Enter admission no"></div>
        <div style="flex:1"><label>Father's Name</label><input id="checkFather" type="text" placeholder="Enter father's name"></div>
      </div>
      <div style="margin-top:12px" class="flex-between">
        <div style="flex:1;margin-right:8px"><button class="btn" onclick="check()">Check</button></div>
        <div style="flex:1;margin-left:8px"><button class="btn-ghost" onclick="backFromCheck()">Back to Menu</button></div>
      </div>
      <div id="checkRes" style="margin-top:12px"></div>
    </div>
  </div>

  <script>
    var usersData = [], studentsData = [], currentUser = null;

    function getField(obj, keys, def){
      for(var i=0;i<keys.length;i++){ if(obj && obj.hasOwnProperty(keys[i]) && obj[keys[i]]!=null) return obj[keys[i]]; }
      return def;
    }

    function sumSubjects(s){
      var list = [
        {keys:['chemistry','chem'], label:'Chemistry', max:75},
        {keys:['compsci','compbio','computer'], label:'Computer/Biology', max:75},
        {keys:['physics','phys'], label:'Physics', max:75},
        {keys:['math','mathematics'], label:'Mathematics', max:75},
        {keys:['english','eng'], label:'English', max:75},
        {keys:['urdu'], label:'Urdu', max:75},
        {keys:['islamiyat','isl'], label:'Islamiyat', max:100},
        {keys:['tarjuma_quran','tarjuma','tar'], label:'Tarjuma-tul-Quran', max:50},
        {keys:['pak','pakstud','pakistan_studies'], label:'Pakistan Studies', max:50}
      ];
      var obj={}, sum=0, maxSum=0;
      for(var i=0;i<list.length;i++){
        var val = Number(getField(s, list[i].keys, 0)) || 0;
        obj[list[i].label]=val;
        sum += val; maxSum += list[i].max;
      }
      return {subjects:obj, obtained:sum, max:maxSum};
    }

    function cleanJSON(text){
      var t = text.replace(/\/\/.*$/mg,'');
      t = t.replace(/,(\s*[\]}])/g,'$1');
      return t;
    }

    function loadJsons(){
      usersData = JSON.parse(localStorage.getItem('users')||'[]');
      fetch('students.json').then(function(r){ if(!r.ok) throw 0; return r.text(); })
        .then(function(text){
          try{ var d = JSON.parse(cleanJSON(text)); studentsData = Array.isArray(d)?d.slice():[]; }catch(e){ studentsData = []; }
        })
        .catch(function(){ studentsData = []; })
        .finally(function(){
          var ls = JSON.parse(localStorage.getItem('students')||'[]');
          ls.forEach(function(s){
            var found=false;
            for(var i=0;i<studentsData.length;i++){ if(String(studentsData[i].admission)===String(s.admission)){ studentsData[i]=Object.assign({},studentsData[i],s); found=true; break; } }
            if(!found) studentsData.push(s);
          });
        });
    }
    loadJsons();

    function login(){
      var u=document.getElementById('loginUser').value||'', p=document.getElementById('loginPass').value||'', found=false;
      usersData.concat(JSON.parse(localStorage.getItem('users')||'[]')).forEach(function(x){ if(x.username===u && x.password===p){ found=true; currentUser=x; } });
      if(u==='admin'&&p==='admin123'){ found=true; currentUser={username:'admin',role:'admin'}; }
      if(found){ document.getElementById('loginBox').classList.add('hidden'); document.getElementById('registerBox').classList.add('hidden'); document.getElementById('menu').classList.remove('hidden'); document.getElementById('loginUser').value=''; document.getElementById('loginPass').value=''; }
      else alert('Invalid credentials or user not registered');
    }
    function showRegister(){ document.getElementById('loginBox').classList.add('hidden'); document.getElementById('registerBox').classList.remove('hidden'); }
    function cancelRegister(){ document.getElementById('registerBox').classList.add('hidden'); document.getElementById('loginBox').classList.remove('hidden'); }
    function register(){
      var u=document.getElementById('regUser').value||'', p=document.getElementById('regPass').value||''; if(!u||!p){ alert('Fill all fields'); return; }
      var users = JSON.parse(localStorage.getItem('users')||'[]'); if(users.some(function(x){return x.username===u})){ alert('Username exists'); return; }
      users.push({username:u,password:p}); localStorage.setItem('users',JSON.stringify(users)); usersData.push({username:u,password:p}); alert('Registered (saved locally)'); document.getElementById('regUser').value=''; document.getElementById('regPass').value=''; cancelRegister();
    }
    function logout(){
      currentUser=null; document.getElementById('menu').classList.add('hidden'); document.getElementById('calc').classList.add('hidden'); document.getElementById('check').classList.add('hidden'); document.getElementById('loginBox').classList.remove('hidden'); document.getElementById('checkRes').innerHTML='';
    }

    function showCalc(){ document.getElementById('menu').classList.add('hidden'); document.getElementById('check').classList.add('hidden'); document.getElementById('calc').classList.remove('hidden'); document.getElementById('resultArea').classList.add('hidden'); }
    function backFromCalc(){ document.getElementById('calc').classList.add('hidden'); document.getElementById('menu').classList.remove('hidden'); }
    function showCheck(){ document.getElementById('menu').classList.add('hidden'); document.getElementById('calc').classList.add('hidden'); document.getElementById('check').classList.remove('hidden'); document.getElementById('checkRes').innerHTML=''; }
    function backFromCheck(){ document.getElementById('check').classList.add('hidden'); document.getElementById('menu').classList.remove('hidden'); }

    function numFix(v){ var n=Number(v); return (isNaN(n)||n<0)?0:n; }
    function gradeCalc(p){
      p = Number(p)||0;
      if(p>=90) return ['A+','Excellent']; if(p>=80) return ['A','Very Good']; if(p>=70) return ['B','Good']; if(p>=60) return ['C','Average']; if(p>=50) return ['D','Pass']; return ['F','Fail'];
    }

    function lookupByAdmission(){
      var adm=document.getElementById('admission').value||''; if(!adm) return;
      var found = studentsData.concat(JSON.parse(localStorage.getItem('students')||'[]')).find(function(s){ return String(s.admission)===String(adm); });
      if(found) fillStudentFields(found);
    }
    function lookupByRoll(){
      var roll=document.getElementById('sroll').value||''; if(!roll) return;
      var found = studentsData.concat(JSON.parse(localStorage.getItem('students')||'[]')).find(function(s){ return String(s.roll)===String(roll); });
      if(found) fillStudentFields(found);
    }

    function fillStudentFields(s){
      document.getElementById('sname').value = getField(s,['name','student_name'],'');
      document.getElementById('sclass').value = getField(s,['class','class_name'],'');
      document.getElementById('sroll').value = getField(s,['roll','roll_no'],'');
      document.getElementById('admission').value = getField(s,['admission','adm'],'');
      document.getElementById('fatherName').value = getField(s,['father','father_name'],'');
      document.getElementById('chem').value = getField(s,['chem','chemistry'],0);
      document.getElementById('compbio').value = getField(s,['compsci','compbio','computer'],0);
      document.getElementById('phys').value = getField(s,['physics','phys'],0);
      document.getElementById('math').value = getField(s,['math','mathematics'],0);
      document.getElementById('eng').value = getField(s,['english','eng'],0);
      document.getElementById('urdu').value = getField(s,['urdu'],0);
      document.getElementById('isl').value = getField(s,['islamiyat','isl'],0);
      document.getElementById('tar').value = getField(s,['tarjuma_quran','tarjuma','tar'],0);
      document.getElementById('pak').value = getField(s,['pak','pakstud','pakistan_studies'],0);
    }

    function generateAndSave(){
      var admission=document.getElementById('admission').value||'', father=document.getElementById('fatherName').value||'', sname=document.getElementById('sname').value||'-', sclass=document.getElementById('sclass').value||'-', sroll=document.getElementById('sroll').value||'-';
      if(!admission||!father){ alert('Admission and father name are required to save'); return; }

      var chem=numFix(document.getElementById('chem').value); if(chem>75)chem=75;
      var comp=numFix(document.getElementById('compbio').value); if(comp>75)comp=75;
      var phys=numFix(document.getElementById('phys').value); if(phys>75)phys=75;
      var math=numFix(document.getElementById('math').value); if(math>75)math=75;
      var eng=numFix(document.getElementById('eng').value); if(eng>75)eng=75;
      var urdu=numFix(document.getElementById('urdu').value); if(urdu>75)urdu=75;
      var isl=numFix(document.getElementById('isl').value); if(isl>100)isl=100;
      var tar=numFix(document.getElementById('tar').value); if(tar>50)tar=50;
      var pak=numFix(document.getElementById('pak').value); if(pak>50)pak=50;

      var total = chem+comp+phys+math+eng+urdu+isl+tar+pak;
      var max = 75*6 + 100 + 50 + 50;
      var per = (total/max)*100;

      var subjPerc = function(val,maxv){ return (maxv? (val/maxv)*100 : 0); };
      var ggchem = gradeCalc(subjPerc(chem,75)), ggcomp = gradeCalc(subjPerc(comp,75)), ggphys = gradeCalc(subjPerc(phys,75));
      var ggmath = gradeCalc(subjPerc(math,75)), ggeng = gradeCalc(subjPerc(eng,75)), ggurdu = gradeCalc(subjPerc(urdu,75));
      var ggisl = gradeCalc(subjPerc(isl,100)), ggtar = gradeCalc(subjPerc(tar,50)), ggpak = gradeCalc(subjPerc(pak,50));
      var gOver = gradeCalc(per);

      // UI summary
      document.getElementById('nameOut').innerText='Name: '+sname;
      document.getElementById('classOut').innerText='Class: '+sclass;
      document.getElementById('rollOut').innerText='Roll No: '+sroll;
      document.getElementById('admOut').innerText='Admission No: '+admission;
      document.getElementById('fatherOut').innerText='Father: '+father;
      document.getElementById('totalOut').innerText='Total Marks: '+total+' / '+max;
      document.getElementById('percOut').innerText='Percentage: '+per.toFixed(2)+'%';
      document.getElementById('gradeOut').innerText='Grade: '+gOver[0];
      document.getElementById('remOut').innerText='Remarks: '+gOver[1];

      document.getElementById('rchem').innerText=chem; document.getElementById('pchem').innerText=(subjPerc(chem,75)).toFixed(1)+'%'; document.getElementById('gchem').innerText=ggchem[0]; document.getElementById('rcem').innerText=ggchem[1];
      document.getElementById('rcomp').innerText=comp; document.getElementById('pcomp').innerText=(subjPerc(comp,75)).toFixed(1)+'%'; document.getElementById('gcomp').innerText=ggcomp[0]; document.getElementById('rcompm').innerText=ggcomp[1];
      document.getElementById('rphys').innerText=phys; document.getElementById('pphys').innerText=(subjPerc(phys,75)).toFixed(1)+'%'; document.getElementById('gphys').innerText=ggphys[0]; document.getElementById('rphysm').innerText=ggphys[1];
      document.getElementById('rmath').innerText=math; document.getElementById('pmath').innerText=(subjPerc(math,75)).toFixed(1)+'%'; document.getElementById('gmath').innerText=ggmath[0]; document.getElementById('rmathm').innerText=ggmath[1];
      document.getElementById('reng').innerText=eng; document.getElementById('peng').innerText=(subjPerc(eng,75)).toFixed(1)+'%'; document.getElementById('geng').innerText=ggeng[0]; document.getElementById('rengm').innerText=ggeng[1];
      document.getElementById('rurdu').innerText=urdu; document.getElementById('purdu').innerText=(subjPerc(urdu,75)).toFixed(1)+'%'; document.getElementById('gurdu').innerText=ggurdu[0]; document.getElementById('rurdum').innerText=ggurdu[1];
      document.getElementById('risl').innerText=isl; document.getElementById('pisl').innerText=(subjPerc(isl,100)).toFixed(1)+'%'; document.getElementById('gisl').innerText=ggisl[0]; document.getElementById('rislm').innerText=ggisl[1];
      document.getElementById('rtar').innerText=tar; document.getElementById('ptar').innerText=(subjPerc(tar,50)).toFixed(1)+'%'; document.getElementById('gtar').innerText=ggtar[0]; document.getElementById('rtarm').innerText=ggtar[1];
      document.getElementById('rpak').innerText=pak; document.getElementById('mpak').innerText=50; document.getElementById('ppak').innerText=(subjPerc(pak,50)).toFixed(1)+'%'; document.getElementById('gpak').innerText=ggpak[0]; document.getElementById('rpakm').innerText=ggpak[1];

      document.getElementById('mchem').innerText=75; document.getElementById('mcomp').innerText=75; document.getElementById('mphys').innerText=75; document.getElementById('mmath').innerText=75; document.getElementById('meng').innerText=75; document.getElementById('murdu').innerText=75; document.getElementById('misl').innerText=100; document.getElementById('mtar').innerText=50;

      document.getElementById('resultArea').classList.remove('hidden');

      saveStudentRecord({
        admission:admission, father:father, name:sname, class:sclass, roll:sroll,
        chem:chem, compbio:comp, physics:phys, math:math, english:eng, urdu:urdu, islamiyat:isl, tarjuma_quran:tar, pak:pak,
        total:max, obtained:total, percent:per.toFixed(2), grade:gOver[0], pass_fail:(gOver[0]==='F'?'Fail':'Pass'), remarks:gOver[1], session:document.getElementById('session').value||'2025-2026'
      });
    }

    function saveStudentRecord(obj){
      var students = JSON.parse(localStorage.getItem('students')||'[]');
      var idx = students.findIndex(function(x){ return String(x.admission)===String(obj.admission); });
      if(idx>=0){ students[idx]=obj; alert('Result updated for admission '+obj.admission); }
      else { students.push(obj); alert('Result saved for admission '+obj.admission); }
      localStorage.setItem('students', JSON.stringify(students));
      var memIdx = studentsData.findIndex(function(x){ return String(x.admission)===String(obj.admission); });
      if(memIdx>=0) studentsData[memIdx]=obj; else studentsData.push(obj);
    }

    function check(){
      var adm=document.getElementById('checkAdm').value||'', father=document.getElementById('checkFather').value||'';
      if(!adm||!father){ document.getElementById('checkRes').innerHTML = '<div class="small">Enter admission and father name</div>'; return; }
      var found = studentsData.concat(JSON.parse(localStorage.getItem('students')||'[]')).find(function(s){
        return String(s.admission)===String(adm) && String(getField(s,['father','father_name'],'')).toLowerCase()===String(father).toLowerCase();
      });
      if(!found){ document.getElementById('checkRes').innerHTML = '<div class="small">No student found.</div>'; return; }
      displayCheckResult(found);
    }

    function displayCheckResult(s){
      var name = getField(s,['name','student_name'],'-');
      var adm = getField(s,['admission','adm'],'-');
      var cls = getField(s,['class','class_name'],'-');
      var roll = getField(s,['roll','roll_no'],'-');
      var father = getField(s,['father','father_name'],'-');
      var session = getField(s,['session'],'2025-2026');

      var totalField = Number(getField(s,['total'], NaN));
      var obtainedField = Number(getField(s,['obtained','obtained_marks','obt'], NaN));
      var subj = sumSubjects(s);
      var obtained = !isNaN(obtainedField)?obtainedField:subj.obtained;
      var max = !isNaN(totalField)?totalField:subj.max;
      var percent = max>0 ? ((obtained/max)*100).toFixed(2) : '0.00';
      var grade = getField(s,['grade'],'-'); var pass_fail = getField(s,['pass_fail'],'-');
      if(grade==='-'||grade===undefined){ grade = gradeCalc(Number(percent))[0]; pass_fail = (Number(percent)>=50)?'Pass':'Fail'; }

      var html = '';
      html += '<div class="info-box"><h3 style="margin:0 0 6px 0;color:#074a8a">'+name+'</h3>';
      html += '<div class="small" style="margin-top:6px">Father: '+father+' Â· Session: '+session+'</divadmin></div>';

      html += '<div class="info-box"><div style="display:flex;gap:16px;flex-wrap:wrap">';
      html += '<div><strong>Total:</strong> '+max+'</div>';
      html += '<div><strong>Marks Obtained:</strong> '+obtained+'</div>';
      html += '<div><strong>Percentage:</strong> '+percent+'%</div>';
      html += '<div><strong>Grade:</strong> '+grade+'</div>';
      html += '<div><strong>Status:</strong> '+pass_fail+'</div>';
      html += '</div></div>';

      html += '<table><thead><tr><th>Subject</th><th>Marks</th></tr></thead><tbody>';
      var subjMap = subj.subjects;
      for(var k in subjMap){ if(subjMap.hasOwnProperty(k)){ html += '<tr><td style="text-align:left;padding-left:12px">'+k+'</td><td>'+subjMap[k]+'</td></tr>'; } }
      html += '</tbody></table>';

      document.getElementById('checkRes').innerHTML = html;
    }

    window._studentsData = studentsData;
    window._reload = function(){ loadJsons(); alert('Reloaded JSON + local storage merge'); };
  </script>
</body>
</html>
